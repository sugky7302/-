# 程式碼撰寫規則
為了統一自己的程式碼風格，在後續維護或開發其他項目上能夠清晰明瞭，特意蒐集網路上或書籍中對程式碼格式的見解，消化吸收後規範成文，讓日後能有個憑依。要記得，程式碼風格無所謂好壞，只要所有程式碼一致，就是好風格。

## 目錄
- [通用](#1)
- [變數](#2)
- [常數](#3)
- [函數](#4)
- [類型](#5)
- [文件](#6)

## 參考
- 無瑕的程式碼：敏捷軟體開發技巧守則,  Robert C. Martin
- 編譯可讀代碼的藝術, Dustin Boswell & Trevor Foucher, 尹哲 & 鄭秀雯 譯
- 代碼大全, Steve McConnell, 電子工業出版社 譯

## 原則
### 基礎
- 程式碼結構的好壞要用「代碼行數」、「時間複雜度」、「內存消耗」與「準確率」做比較
- 程式碼要能讓人快速理解、輕鬆維護、容易擴展
- 程式碼的寫法應當使別人理解它所需的時間最小化
- 一次只做一件事
    - 列出程式碼所做的所有任務
    - 盡量把這件任務拆分到不同的函數中
- 用自然語言描述程式碼要做什麼，把想法變成程式碼
- 把條件、循環以及其他隊控制流的改變做得越"自然"越好，運用一種方式使讀者不用停下來重讀你的代碼
- 通過提早返回(Guard Clause原則)來減少嵌套
- 把你的超長表達式拆分成更容易理解的小塊
- 總結變量:用一個短很多的名字取代一大塊代碼，例如取代條件語句
- 減少變量
- 減少中間結果
- 減少控制流變量
- 縮小變量的作用域
- 如果類別的成員變量只有少量方法用到，那就把它降格進方法內
- 把大東西拆分成小東西，彼此獨立才有作用，主要動機是數據分離
- 如果某個變量必須被某一個函數所使用，且無法改成local，可以考慮把函數變成閉包來處理
- 只寫一次的變量更好:只設置一次值的變量(或常量)使得代碼更容易理解
- 抽取不相關的子問題
- 簡化已有接口，永遠不要安於使用不理想的接口

### 系統架構
- 系統
- 子系統和套件
- 套件中的類別
- 類別中的數據和子程序
- 子程序內部

### 設計方法
- 理解問題
	- 未知量
	- 條件
	- 數據
	- 使用畫圖能夠輕鬆釐清彼此之間的關係
- 設計一個計劃
	- 找出彼此之間的關係
	- 搜尋類似的已解決的問題
	- 如果解決不了問題，先找出特化版的問題予以解決
	- 用上全部的數據、條件
	- 考慮問題涉及的所有的核心概念
	- 建立一個實驗性原型(用於回答特定設計問題、量最少且能夠隨時扔掉的程式碼)
- 執行計劃
	- 執行的過程中要檢查每一步是否正確
- 回顧
	- 測試結果是否正確

### 類別
- 將實現細節隱藏在其中，讓使用者不用思考該怎麼實現
- 公開函數必須要讓使用者一看就理解該怎麼使用，且須與類別職能一致
- 一定要抓緊類別的職能方向，必須單一
- 好的類別其抽象與內聚的程度也高
- 盡可能限制類和成員的可訪問性，根據需求考慮暴露成員數據，例如:point有x這個座標參數，如果setX、getX只是單純存取x而內部沒有額外操作的話，應該直接使用point.x
- 不要對類別的使用者做出任何假設
- 撰寫優良的接口和子程序，閱讀程式碼時能夠一目瞭然
- 切記！千萬不要因為一個子程序裡僅使用公用子程序，就把它歸入公開接口
- 類別和其成員是「包含(has a)」的關係，而父類別和子類別是「繼承(is a)」的關係
- 一個類別不要超過9個成員參數
- 子類別是父類別的一個特殊版本，如果子類別不完全遵守父類別定義的同一接口契約，請使用包含的方式，或是對父類做修改
- 如果類別只有一個實例，考慮要不要直接改成對象
- 不要創建任何並非絕對必要的繼承結構
- 如果許多子類別覆蓋了某個父類別接口，但修改了此接口的語意，這通常表示父類別的設計有問題
- 盡量減少類和類之間相互合作的範圍
- 創建類別的原因
	- 為現實對象建模
	- 為抽象的對象建模
	- 降低複雜度
	- 隱藏實現細節
	- 限制修改的影響範圍
	- 讓程式碼更易於重用
- 避免創建萬能類
- 類別必須具有數據成員和行為成員兩個方面，缺一都要考慮如何修改

### 子程序
- 必須有單一目的
- 降低複雜度
- 提高可讀性，讓使用者清楚該程式碼的用意，甚至取代註釋
- 避免重複
- 簡化條件判斷
- 提高可移植性
- 改善性能
- 使用語氣強烈地動詞加賓語命名能夠清楚表達用途
- 使用所有的參數
- 不要把參數用作中間變量

### 偽代碼
- 創建類別的步驟為以下程序，->N 表示下個可執行的步驟編號
	1. 開始->2
	2. 創建類別的總體設計: 定義職責、精確定義接口所表示的概念、決定是否繼承或是可繼承、標示要用到的數據成員->3
	3. 創建類別中的子程序->2 4
		1. 開始->2
		2. 設計子程序->3
		3. 檢查設計->2 4
		4. 編寫子程序的程式碼->5
		5. 檢查並測試->2 4 6
		6. 完成
	4. 檢查並測試整個類別: 子程序要測試，整個類別可以使用後再對整體進行檢查和測試->2 3 5
	5. 完成
- 使用類似英語的語句來精確描述特定操作
- 避免使用目標編程語言中的語法元素，要站在比程式碼高的層次去撰寫，這樣就能套用在不同語言上
- 用偽代碼去描述解決問題的方法的意圖
- 要不斷精化偽代碼，加入越來越多的細節，直到看起來已經很容易直接寫出程式碼為止
- 寫出程式碼後，將偽代碼當作註釋，因此你要做的是刪除多餘的註釋，而不是加進來
- ex: 通過偽代碼創建子程序
	- 檢查先決條件
	- 定義子程序要解決的問題
		- 要隱藏的訊息
		- 輸入參數
		- 輸出值
	- 命名
	- 決定如何測試子程序
	- 找尋有無已經寫好且可用的好的程式碼，如果找不到可以去找算法或模型
	- 思索子程序的所有執行路徑，考慮其錯誤處理
	- 編寫偽代碼
		- 頂端註釋: 寫下該子程序的目的
	- 如果子程序的重點是對數據類型的操作，那要先設計好數據類型
	- 檢查偽代碼
	- 在偽代碼中試驗一些想法，留下最好的想法(迭代)
	- 轉成程式碼: 無特定順序，但所有步驟都會實現
		- 寫出子程序的聲明
		- 編寫第一條和最後一條語句，然後將偽代碼轉換為高層次的註釋
		- 每條註釋下面填寫程式碼
		- 檢查程式碼是否需要進一步分解
		- 逐步執行程式碼來檢查錯誤
		- 測試
		- 收尾
			- 檢查接口
			- 檢查設計質量，確定子程序只做一件事
			- 檢查是否有命名不好的變量或是沒用到的變量
			- 檢查語句和邏輯
			- 檢查佈局
			- 檢查文字說明、註釋是否精確
			- 刪除冗餘的註釋

### 變量
- 盡量靠近第一次使用變量的位置聲明並初始化該變量
- 注意計數器和累加器
- 在類別的建構函數裡初始化該類別的數據成員
- 低跨度和低存活時間
	- 計算變量跨度(兩次引用之間間隔的程式碼數)
	- 計算存活間(第一次引用和最後一次引用間隔的程式碼數)
- 把相關語句放到一起
- 把相關語句組提取成單獨的子程序
- 每個變量只用於單一用途
- 避免隱含含意和雙重用途，ex: page_count的取值可能表示已列印紙張的數量，除非它等於-1，在這種情況表明有錯誤發生。這個例子就是整數和布林混用
- 確保使用了所有已聲明的變量
- 命名要完全、準確地描述出該變量所代表的事物
- 變量名的最佳長度在10-16個字符，8-20亦可，最主要是要能夠表達清晰
- 長名字的變量適用於很少用到的變量或全域變量，短名字的變量適用於局部變量或循環變量
- 變量的名字若有限定詞，例如：total、sum、max等等，所有變量都要保持一致性
- 常用的對稱命名
	- begin/end
	- first/last
	- locked/unocked
	- min/max
	- next/previous
	- old/new
	- opened/closed
	- visible/invisible
	- source/target
	- source/destination
	- up/down
- 約定俗成的變量名可以適時使用，但重點是不要造成誤解
- 旗幟變量不要命名xxxflag，這違反了原則
- 中間(暫存)變量的命名也要表達清晰
- 布林變量不要給予同時隱含真假的名字，例如：status，要使用肯定的命名，以下為幾個有用的名字
	- done: 表示事情已經完成
	- error: 表示有錯誤發生
	- found: 表示某個值已經找到了
	- success/ok: 表示某個操作是否成功
- 不要在前面加is，這也會同時隱含真假
- 有些變量名可以使用縮寫，但是必須採用標準的縮寫
- 避免在名字中使用數字

### 基礎數據類型
- 避免使用未經解釋的常量
- 使類型轉換變明顯
- 整數
	- 檢查整數除法
	- 檢查溢出
	- 檢查中間結果溢出
- 浮點數
	- 避免數量級相差距大的數之間的加減運算
	- 避免等量判斷，例如0.1+0.1+...+0.1(10次)不一定等於1.0，因為會有機器誤差
- 字符和字符串
	- 避免使用神秘字符和神祕字符串
	- 如果你知道只需要支持一種文字的語言，請考慮使用ISO8859字符集；如果你需要支持多種語言，請使用Unicode
- 布林變量
	- 用布林變量修飾程序，使其易讀
	- 用布林變量來簡化複雜的判斷
	- 如果需要的話，創建你自己的布林類型
- 枚舉類型
	- 用枚舉類型提高可讀性
	- 用枚舉類型提高可靠性
	- 用枚舉類型來簡化修改，例如：1代表紅色、2代表綠色這個方案發現一處缺陷，你就必須從頭到尾檢查程式碼，如果用枚舉類型，就只要向列表增加元素
	- 將枚舉類型作為布林變量的替換方案
	- 定義出枚舉的第一項和最後一項，以便用於循環邊界
	- 把枚舉類型的第一個元素留做非法值
- 具名常量
	- 在數據聲明中使用具名常量
	- 避免使用神秘常量，即便是安全的
- 數組
	- 確認所有的數組索引都沒有超出數組的邊界
	- 考慮用容器來取代數組，或者將數組作為順序化結構來處理
	- 如果數組是多維的，確認索引的使用順序是正確的
- 自定義數據類型
	- 給所創建的類型取功能導向的名字
	- 不要重定義一個預定義的類型
	- 考慮創建一個類而不是使用typedef

### 結構體
- 簡化對數據塊的操作
- 簡化參數列表
- 減少維護

### 全域數據
- 要求所有的程式碼通過訪問器子程序來存取數據，提高可讀性。例如：event_count = event_count + 1可以寫成AddEvent(event_count)

### 註釋
- 註釋的目的是盡量幫助讀者了解得和作者一樣多
- 加入「導演評論」，記錄你對代碼有價值的見解
- 為代碼中的瑕疵寫註釋
    - NOTE: 註釋
	- TODO: 我還沒處理的事情
	- FIXME: 已知的無法運行的代碼
	- HACK: 對一個問題不得不草用的比較粗糙的解決方案
	- BUG: 危險!這裡有重要的問題
- 給常量加註釋，讓讀代碼的人有了調整這個值的指南
- 站在讀者的角度，去想像他們需要知道什麼而給予註釋
	- 意料之中的提問
	- 公布可能的陷阱
	- 全局觀註釋，例如類別之間如何交互，數據如何在整個系統中流動等等
	- 總結性註釋
- 做任何能幫助讀者更容易理解代碼的事
	- 不管你心裡想什麼，先把它寫下來
	- 讀一下這段註釋，看看有沒有什麼地方可以改進
	- 不斷改進
- 寫出言簡意賅的註釋
    - 保持緊湊
    - 避免使用不明確的代詞
    - 潤色粗糙的句子
    - 精確描述函數的行為
    - 用輸入/輸出例子來說明特別的情況
    - 聲明程式碼的意圖
    - 採用訊息含量高的詞

### 測試
- 測試應當具有可讀性，以便其他程序員可以舒服地改變或者增加測試
- 你應當選擇一組最簡單的輸入，它能完整地使用被測代碼

##<a1 id = "1"> 通用 </a1>
函數、變數、文件盡量給有描述性的命名，少用縮寫。若是要設為私有，則在名稱最前面加入下劃線，但局部變量不用加下劃線。

##<a1 id = "2"> 變數 </a1>
變數名一律小寫, 單詞之間用底線連接，參數、類別靜態或非靜態變數亦同。類別成員變數必須以一條下劃線結尾。
變數聲明請放在使用函數的上面，過去放在最上面是因為舊的IDE限制。

##<a1 id = "3"> 常數 </a1>
常數名採全大寫，單詞之間用底線連接，如：VARIABLE_TEST。

##<a1 id = "4"> 函數 </a1>
函數名採小駝峰法，比如：myFunction，取值與設值函數則要求與參數名匹配：setNumEntries(num_entries)。
此外，函數內若有調用函數，請將函數寫在原函數下面，並於頂端聲明。若是遇到多個函數調用同一函數，則該函數需寫在最後調用它的函數後面。
其它非常短小的內聯函式(<10行)名也可以用小寫字母, 例如. 如果你在循環中呼叫這樣的函式甚至都不用緩存其返回值, 小寫命名就可以接受.

##<a1 id = "5"> 類型 </a1>
類型、類別均使用大駝峰法，和[函數](#4)相同。若有慣用命名，則使用它。如果成員變量是函數，就按照函數的命名方式，也不用下劃線結尾。

##<a1 id = "6"> 文件 </a1>
文件名要全部小寫，單詞之間用下劃線連接，比如：new_document。